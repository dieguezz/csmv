{"version":3,"sources":["../../../client/components/auth/router.decorator.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,CAAC,YAAW;;AAEZ,SAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAC3B,GAAG,CAAC,UAAS,UAAU,EAAE,MAAM,EAAE,IAAI,EAAE;;AAEtC,cAAU,CAAC,GAAG,CAAC,mBAAmB,EAAE,UAAS,KAAK,EAAE,IAAI,EAAE;AACxD,UAAG,CAAC,IAAI,CAAC,YAAY,EAAE;AACrB,eAAO;OACR;;AAED,UAAI,KAAK,GAAG,OAAO,IAAI,CAAC,YAAY,KAAK,QAAQ,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC;;AAEnF,WAAK,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,EAAI;AACtB,YAAG,CAAC,IAAI,EAAE;AACR,eAAK,CAAC,cAAc,EAAE,CAAC;AACvB,cAAI,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,UAAA,EAAE,EAAI;AAC3B,kBAAM,CAAC,EAAE,CAAC,EAAE,GAAG,MAAM,GAAG,OAAO,CAAC,CAAC;WAClC,CAAC,CAAC;SACJ;OACF,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;CAEJ,CAAA,EAAG,CAAC","file":"router.decorator.js","sourcesContent":["'use strict';\n\n(function() {\n\nangular.module('csmvApp.auth')\n  .run(function($rootScope, $state, Auth) {    \n    // Redirect to login if route requires auth and the user is not logged in, or doesn't have required role\n    $rootScope.$on('$stateChangeStart', function(event, next) {    \n      if(!next.authenticate) {\n        return;\n      }\n\n      let query = typeof next.authenticate === 'string' ? Auth.hasRole : Auth.isLoggedIn;\n\n      query(1,2).then(good => {\n        if(!good) {\n          event.preventDefault();\n          Auth.isLoggedIn().then(is => {\n            $state.go(is ? 'main' : 'login');\n          });\n        }\n      });\n    });    \n  });\n\n})();\n"]}